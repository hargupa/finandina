var app=angular.module("SimuladorVehiculos",[]);app.controller("SimuladorController",["$scope","$window","$filter",function(a,o,e){firebase.initializeApp({apiKey:"AIzaSyC8vrdhMCthhxAw7CwEfN3OnVWPbHNFVpk",authDomain:"simuladores-75631.firebaseapp.com.firebaseapp.com",databaseURL:"https://simuladores-75631.firebaseio.com",storageBucket:"simuladores-75631.appspot.com.appspot.com"}),a.Math=window.Math,a.data={tasa:1.22,minMonto:3e6,maxAnioCarro:14,maxAnioMoto:4,montoFinanciar:"",cuotaMensual:"",precioVehiculo:"",cuotaInicial:"",plazo:"",anioModelo:"",marcaVehiculo:"",errorPrecio:"",errorCuota:"",errorMonto:"",cuota72meses:"",cuota60meses:"",cuota48meses:"",cuota36meses:"",cuota24meses:"",cuota12meses:"",ShowMonto72MesesCuota:!1,ShowMonto60MesesCuota:!1,ShowMonto48MesesCuota:!1,ShowMonto36MesesCuota:!1,ShowMonto24MesesCuota:!1,ShowMonto12MesesCuota:!1,ShowImgCarro:!0,ShowImgMoto:!1,ShowTextoPorcentaje:!1,ShowForm:!0,ShowTerminos:!1,ShowTextoUsado:!1,ShowTextoNuevo:!0,ShowErrorValor:!1,ShowModeloCarroMoto:!0,ShowModeloCarroUsado:!1,ShowModal:!1,nombre:"",celular:"",email:""},a.MostrarCuota=function(o){switch(a.data.ShowMonto72MesesCuota=!1,a.data.ShowMonto60MesesCuota=!1,a.data.ShowMonto48MesesCuota=!1,a.data.ShowMonto36MesesCuota=!1,a.data.ShowMonto24MesesCuota=!1,a.data.ShowMonto12MesesCuota=!1,o){case 1:a.data.ShowMonto72MesesCuota=!0,a.data.plazo=72,a.data.cuotaMensual=a.data.cuota72meses;break;case 2:a.data.ShowMonto60MesesCuota=!0,a.data.plazo=60,a.data.cuotaMensual=a.data.cuota60meses;break;case 3:a.data.ShowMonto48MesesCuota=!0,a.data.plazo=48,a.data.cuotaMensual=a.data.cuota48meses;break;case 4:a.data.ShowMonto36MesesCuota=!0,a.data.plazo=36,a.data.cuotaMensual=a.data.cuota36meses;break;case 5:a.data.ShowMonto24MesesCuota=!0,a.data.plazo=24,a.data.cuotaMensual=a.data.cuota24meses;break;case 6:a.data.ShowMonto12MesesCuota=!0,a.data.plazo=12,a.data.cuotaMensual=a.data.cuota12meses;break;default:a.data.cuotaMensual="",a.data.plazo=""}0==a.data.ShowImgCarro&&(a.data.ShowMonto72MesesCuota=!1)},a.CambiarVehiculo=function(){1==a.data.ShowImgCarro?(a.data.ShowImgCarro=!1,a.data.ShowImgMoto=!0,a.data.ShowMonto72Meses=!1,a.data.ShowMonto72MesesCuota=!1,a.data.ShowModeloCarroMoto=!0,a.data.ShowModeloCarroUsado=!1):(a.data.ShowImgCarro=!0,a.data.ShowImgMoto=!1,a.data.ShowMonto72Meses=!0,a.data.ShowMonto72MesesCuota=!1),a.data.anioModelo="",a.data.marcaVehiculo="",a.calcularDatos()},a.CambiarEstadoVehiculo=function(){1==a.data.ShowTextoNuevo?(a.data.ShowTextoUsado=!0,a.data.ShowTextoNuevo=!1,a.data.ShowModeloCarroMoto=!1,a.data.ShowModeloCarroUsado=!0):(a.data.ShowTextoUsado=!1,a.data.ShowTextoNuevo=!0,a.data.ShowModeloCarroMoto=!0,a.data.ShowModeloCarroUsado=!1),a.data.anioModelo="",a.calcularDatos()},a.calcularDatos=function(){if(a.data.errorPrecio="",a.data.errorCuota="",a.data.errorMonto="",a.data.errorModelo="",a.data.cuotaMensual="",a.agregarClase(),""==a.data.cuotaInicial&&a.data.ShowTextoUsado)return a.data.errorCuota="Indica la cuota inicial del vehÍculo",!1;_precioVehiculo=a.data.precioVehiculo.replace(/\,/g,""),_cuotaInicial=parseInt(a.data.cuotaInicial.replace(/\,/g,"")),isNaN(_cuotaInicial)&&(_cuotaInicial=0);var o=(new Date).getFullYear()-a.data.anioModelo;return a.data.ShowImgCarro&&o>a.data.maxAnioCarro||a.data.ShowImgMoto&&o>a.data.maxAnioMoto?(a.data.errorModelo="El modelo del vehÍculo no es factible",a.data.montoFinanciar="",a.data.cuotaMensual="",!1):(_montoFinanciar=_precioVehiculo-_cuotaInicial,a.data.montoFinanciar=_montoFinanciar>=0?_montoFinanciar:0,a.data.montoFinanciar<a.data.minMonto?(a.data.errorMonto="El monto mínimo a financiar debe ser mayor que "+e("currency")(a.data.minMonto,"$",0),!1):(a.data.cuota72meses=a.calculoCuotaMensual(a.data.tasa,72,a.data.montoFinanciar),a.data.cuota60meses=a.calculoCuotaMensual(a.data.tasa,60,a.data.montoFinanciar),a.data.cuota48meses=a.calculoCuotaMensual(a.data.tasa,48,a.data.montoFinanciar),a.data.cuota36meses=a.calculoCuotaMensual(a.data.tasa,36,a.data.montoFinanciar),a.data.cuota24meses=a.calculoCuotaMensual(a.data.tasa,24,a.data.montoFinanciar),a.data.cuota12meses=a.calculoCuotaMensual(a.data.tasa,12,a.data.montoFinanciar),void a.MostrarCuota()))},a.calculoPorcentajeFinanciacion=function(){var o=20;return a.data.ShowImgMoto&&(a.data.ShowTextoNuevo&&a.data.plazo>=12&&a.data.plazo<=60||a.data.ShowTextoUsado&&a.data.plazo>=12&&a.data.plazo<=48)&&(o=100),a.data.ShowImgCarro&&(a.data.ShowTextoNuevo&&a.data.plazo>=12&&a.data.plazo<=60?o=100:a.data.ShowTextoUsado&&a.data.plazo>=12&&a.data.plazo<=60&&(o=30)),o},a.calculoCuotaMensual=function(a,o,e){var t=(1+(a/=100))**o,r=a*t*e/(t-1);return Math.round(r)},a.guardarInfo=function(){if(a.data.errornombre="",a.data.errorcel="",a.data.erroremail="",""==a.data.nombre)return a.data.errornombre="Indica tu nombre y apellido",!1;if(isNaN(a.data.celular)||!/^3[\d]{9}$/.test(a.data.celular))return a.data.errorcel="Indica un número con el formato correcto",!1;if(""==a.data.email)return a.data.erroremail="Indica tu correo electrónico",!1;if(!/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(a.data.email))return a.data.erroremail="Indica una dirección de correo electrónico con el formato correcto",!1;a.writeFirebase()&&(a.data.ShowModal=!0)},a.writeFirebase=function(){var o=localStorage.getItem("simulacion"),e=JSON.parse(o),t=!1;try{var r={DatosPersonales:{nombre:a.data.nombre,celular:a.data.celular,email:a.data.email},Simulacion:e};t=firebase.database().ref("vehiculo").push(r)}catch(a){console.log(a)}return localStorage.removeItem("simulacion"),t},a.contactenos=function(){if(""!=a.data.anioModelo&&""!=a.data.precioVehiculo&&""!=a.data.cuotaInicial){_cuotaInicial=parseInt(a.data.cuotaInicial.replace(/\,/g,"")),_precioVehiculo=parseInt(a.data.precioVehiculo.replace(/\,/g,""));var e={tipoVehiculo:a.data.ShowImgCarro?"Carro":"Moto",estadoVehiculo:a.data.ShowTextoNuevo?"Nuevo":"Usado",marcaVehiculo:a.data.marcaVehiculo,anioModelo:a.data.anioModelo,periodoPago:"Meses",tasa:a.data.tasa,precioVehiculo:_precioVehiculo,cuotaInicial:_cuotaInicial,montoFinanciar:a.data.montoFinanciar,cuotaMensual:a.data.cuotaMensual,plazo:a.data.plazo};localStorage.setItem("simulacion",JSON.stringify(e))}o.location.href="formContacto.html"},a.showindex=function(){o.location.href="index.html"},a.agregarClase=function(){""==a.data.anioModelo?angular.element(document.querySelector("#selectModelo")).removeClass("ctrol-gris"):angular.element(document.querySelector("#selectModelo")).addClass("ctrol-gris"),""==a.data.marcaVehiculo?angular.element(document.querySelector("#selectMarca")).removeClass("ctrol-gris"):angular.element(document.querySelector("#selectMarca")).addClass("ctrol-gris"),""==a.data.marcaVehiculo?angular.element(document.querySelector("#selectMarca")).removeClass("ctrol-gris"):angular.element(document.querySelector("#selectMarca")).addClass("ctrol-gris"),""==a.data.precioVehiculo||0==a.data.precioVehiculo?angular.element(document.querySelector("#precioVehiculo")).removeClass("ctrol-gris"):angular.element(document.querySelector("#precioVehiculo")).addClass("ctrol-gris"),""==a.data.cuotaInicial||0==a.data.cuotaInicial?angular.element(document.querySelector("#cuotaInicial")).removeClass("ctrol-gris"):angular.element(document.querySelector("#cuotaInicial")).addClass("ctrol-gris")}}]),app.directive("mileskeypress",(function(){return{restrict:"A",require:"ngModel",link:function(a,o,e,t){var r=function(a){if(void 0===a)return"";var o=(a=a.replace(/\,/g,"")).replace(/[^0-9,]/g,"");if(o!==a)t.$setViewValue(o),t.$render();else{if(o>999){for(var e=parseInt(o).toString().split(""),r=0,n=[],c=e.length-1,l=c;l>=0;l--){var i=e[l].replace(/\,/g,"");""!=i&&(c>=3?2==r&&0!=l?(n[l]=","+i,r=0):(n[l]=i,r+=1):n[l]=i)}o=n.join("")}t.$setViewValue(o),t.$render(),t.$setValidity("onlyNumbers",!0)}return o};t.$parsers.unshift(r),t.$parsers.push(r),e.$observe("onlyNumbers",(function(){r(t.$ViewValue)}))}}})).directive("letterkeypress",(function(){return{restrict:"A",require:"ngModel",link:function(a,o,e,t){var r=function(a){if(void 0===a)return"";var o=a.replace(/[^A-Za-z ]/g,"");return o!==a?(t.$setViewValue(o),t.$render()):t.$setValidity("onlyLetters",!0),o};t.$parsers.unshift(r),t.$parsers.push(r),e.$observe("onlyLetters",(function(){r(t.$ViewValue)}))}}})).directive("numberkeypress",(function(){return{restrict:"A",require:"ngModel",link:function(a,o,e,t){var r=function(a){if(void 0===a)return"";var o=a.replace(/[^0-9]/g,"");return o!==a?(t.$setViewValue(o),t.$render()):t.$setValidity("onlyNumbers",!0),o};t.$parsers.unshift(r),t.$parsers.push(r),e.$observe("onlyLetters",(function(){r(t.$ViewValue)}))}}}));