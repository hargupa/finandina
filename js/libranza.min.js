var app=angular.module("Libranza",[]);app.controller("LibranzaController",["$scope","$window","$filter",function(a,o,t){firebase.initializeApp({apiKey:"AIzaSyC8vrdhMCthhxAw7CwEfN3OnVWPbHNFVpk",authDomain:"simuladores-75631.firebaseapp.com.firebaseapp.com",databaseURL:"https://simuladores-75631.firebaseio.com",storageBucket:"simuladores-75631.appspot.com.appspot.com"}),a.data={tasa:1.2,SMMLV:877803,minMontoPerimitido:3e6,minCuotaPerimitido:3e6,maxMontoPerimitido:1e8,maxCuotaPerimitido:1e8,capacidadDescuentoMonto:53400,capacidadDescuentoCuota:18e4,descuentoNomina:"",ingresos:"",selectActividad:"0",selectConvenio:"0",montoAprox:"",cuotaAprox:"",AproxCalculada:"",descuentoSalud:"",maxCuota:"",plazo:"",porcentajeDescuentos:"",errorDescNomina:"",errorIngresos:"",errorActividad:"",errorMonto:"",errorCuota:"",errorplazo:"",errorexcede:"",Cuota120:"",Cuota108:"",Cuota96:"",Cuota84:"",Cuota72:"",Cuota60:"",Monto120:"",Monto108:"",Monto96:"",Monto84:"",Monto72:"",Monto60:"",Show120Meses:!1,Show108Meses:!1,Show96Meses:!1,Show84Meses:!1,Show72Meses:!1,Show60Meses:!1,ShowTextoPorcentaje:!1,ShowImgDefault:!0,ShowImgSectorPublico:!1,ShowImgDocente:!1,ShowImgFuerzas:!1,ShowImgPensionado:!1,ShowCuota:!1,ShowMonto:!0,ShowForm:!0,ShowAviso:!1,ShowModal:!1,nombre:"",celular:"",email:""},a.Cambiar=function(){1==a.data.ShowCuota?(a.data.ShowCuota=!1,a.data.ShowMonto=!0):(a.data.ShowCuota=!0,a.data.ShowMonto=!1),a.data.montoAprox="",a.data.cuotaAprox="",a.data.AproxCalculada="",a.data.errorDescNomina="",a.data.errorIngresos="",a.data.errorActividad="",a.data.errorMonto="",a.data.errorCuota="",a.data.errorplazo="",a.data.errorexcede=""},a.limpiarPlazo=function(){a.data.plazo="",a.data.Show120Meses=!1,a.data.Show108Meses=!1,a.data.Show96Meses=!1,a.data.Show84Meses=!1,a.data.Show72Meses=!1,a.data.Show60Meses=!1,a.data.Monto120="",a.data.Monto108="",a.data.Monto96="",a.data.Monto84="",a.data.Monto72="",a.data.Monto60="",a.data.Cuota120="",a.data.Cuota108="",a.data.Cuota96="",a.data.Cuota84="",a.data.Cuota72="",a.data.Cuota60=""},a.CambiarActividad=function(){switch(a.data.ShowImgDefault=!1,a.data.ShowImgSectorPublico=!1,a.data.ShowImgDocente=!1,a.data.ShowImgFuerzas=!1,a.data.ShowImgPensionado=!1,a.limpiarPlazo(),a.data.selectActividad){case"0":a.data.ShowImgDefault=!0;break;case"1":a.data.ShowImgSectorPublico=!0;break;case"2":a.data.ShowImgDocente=!0;break;case"3":a.data.ShowImgFuerzas=!0;break;case"4":a.data.ShowImgPensionado=!0}a.calcularDatos()},a.MostrarCuota=function(o){switch(a.data.plazo="",a.data.Show120Meses=!1,a.data.Show108Meses=!1,a.data.Show96Meses=!1,a.data.Show84Meses=!1,a.data.Show72Meses=!1,a.data.Show60Meses=!1,o){case 1:a.data.plazo=120,a.data.Show120Meses=!0,a.data.AproxCalculada=a.data.ShowMonto?a.data.Monto120:a.data.Cuota120;break;case 2:a.data.plazo=108,a.data.Show108Meses=!0,a.data.AproxCalculada=a.data.ShowMonto?a.data.Monto100:a.data.Cuota108;break;case 3:a.data.plazo=96,a.data.Show96Meses=!0,a.data.AproxCalculada=a.data.ShowMonto?a.data.Monto96:a.data.Cuota96;break;case 4:a.data.plazo=84,a.data.Show84Meses=!0,a.data.AproxCalculada=a.data.ShowMonto?a.data.Monto84:a.data.Cuota84;break;case 5:a.data.plazo=72,a.data.Show72Meses=!0,a.data.AproxCalculada=a.data.ShowMonto?a.data.Monto72:a.data.Cuota72;break;case 6:a.data.plazo=60,a.data.Show60Meses=!0,a.data.AproxCalculada=a.data.ShowMonto?a.data.Monto60:a.data.Cuota60;break;default:a.data.AproxCalculada="",a.data.plazo=""}},a.mostrarTerminos=function(){a.data.ShowForm=!1,a.data.ShowTerminos=!0},a.ocultarTerminos=function(){a.data.ShowForm=!0,a.data.ShowTerminos=!1},a.validaciones=function(){if(a.data.errorActividad="",a.data.errorIngresos="",a.data.errorDescNomina="",a.data.errorMonto="",a.data.errorCuota="",a.data.errorplazo="",a.data.errorexcede="",a.data.AproxCalculada="",a.limpiarPlazo(),"0"==a.data.selectActividad)return a.data.errorActividad="Indica tu actividad",!1;if(""==a.data.ingresos)return a.data.errorIngresos="Indica tus ingresos mensuales",!1;if(!a.data.ShowImgPensionado&&(_ingresos=a.data.ingresos.replace(/\,/g,""),_ingresos<a.data.SMMLV))return a.data.errorIngresos="Ingreso mínimo 1 SMMLV",!1;if(""==a.data.descuentoNomina)return a.data.ShowImgPensionado?a.data.errorDescNomina="Indica tus descuentos":a.data.errorDescNomina="Indica tus descuentos por nómina",!1;if(a.data.ShowMonto){if(""==a.data.montoAprox)return a.data.errorMonto="Indica la cantidad de dinero que necesita",!1;if(_montoAprox=a.data.montoAprox.replace(/\,/g,""),_montoAprox<a.data.minMontoPerimitido)return a.data.errorMonto="El monto mínimo que te prestamos es de "+t("currency")(a.data.minMontoPerimitido,"$",0),!1;if(_montoAprox>a.data.maxMontoPerimitido)return a.data.errorMonto="El monto que intentas solicitar es superior a tu capacidad de endeudamiento, el valor máximo que te podemos prestar es "+t("currency")(a.data.maxMontoPerimitido,"$",0),!1}return!a.data.ShowCuota||""!=a.data.cuotaAprox||(a.data.errorCuota="Indica la cuota que quieres pagar",!1)},a.calcularDatos=function(){if(!a.validaciones())return!1;if(""==a.data.porcentajeDescuentos&&(a.data.ShowImgPensionado?a.data.porcentajeDescuentos=.12:a.data.porcentajeDescuentos=.08),_ingresos=a.data.ingresos.replace(/\,/g,""),_descuentoNomina=a.data.descuentoNomina.replace(/\,/g,""),a.data.descuentoSalud=_ingresos*a.data.porcentajeDescuentos,a.data.maxCuota=(_ingresos-a.data.descuentoSalud)/2-_descuentoNomina,a.data.ShowMonto){if(a.data.maxCuota<a.data.capacidadDescuentoMonto)return void(a.data.errorexcede="La cuota mensual excede tu capacidad de descuento");_montoAprox=a.data.montoAprox.replace(/\,/g,""),a.data.Monto120=a.calculoCuotaAprox(a.data.tasa,120,_montoAprox),a.data.Monto108=a.calculoCuotaAprox(a.data.tasa,108,_montoAprox),a.data.Monto96=a.calculoCuotaAprox(a.data.tasa,96,_montoAprox),a.data.Monto84=a.calculoCuotaAprox(a.data.tasa,84,_montoAprox),a.data.Monto72=a.calculoCuotaAprox(a.data.tasa,72,_montoAprox),a.data.Monto60=a.calculoCuotaAprox(a.data.tasa,60,_montoAprox)}else if(a.data.ShowCuota){if(a.data.maxCuota<a.data.capacidadDescuentoCuota)return void(a.data.errorexcede="La cuota indicada excede tu capacidad de descuento, solicita un monto menor");if(_cuotaAprox=a.data.cuotaAprox.replace(/\,/g,""),_cuotaAprox>a.data.maxCuota)return void(a.data.errorexcede="La cuota indicada excede tu capacidad de descuento, solicita un monto menor");a.data.Cuota120=a.calculoRedondearMenos(a.calculoMontoAprox(a.data.tasa,120,_cuotaAprox),5),a.data.Cuota108=a.calculoRedondearMenos(a.calculoMontoAprox(a.data.tasa,108,_cuotaAprox),5),a.data.Cuota96=a.calculoRedondearMenos(a.calculoMontoAprox(a.data.tasa,96,_cuotaAprox),5),a.data.Cuota84=a.calculoRedondearMenos(a.calculoMontoAprox(a.data.tasa,84,_cuotaAprox),5),a.data.Cuota72=a.calculoRedondearMenos(a.calculoMontoAprox(a.data.tasa,72,_cuotaAprox),5),a.data.Cuota60=a.calculoRedondearMenos(a.calculoMontoAprox(a.data.tasa,60,_cuotaAprox),5)}},a.calculoCuotaAprox=function(a,o,t){var e=a/100,r=Math.pow(1+e,o),n=e*r*t/(r-1);return isNaN(n)&&(n=0),Math.round(n)},a.calculoMontoAprox=function(a,o,t){var e=a/100,r=Math.pow(1+e,o),n=t*((r-1)/(e*r));n=Math.round(n);var d=Math.min(n,1e8);return isNaN(d)&&(result=0),d},a.calculoRedondearMenos=function(a,o){var t=a.toString(),e=t.length;if(e>o){for(var r=e-o,n=t.slice(0,r),d=0;d<o;d++)n=n.concat("0");return parseInt(n)}return 0},a.obtenerDatos=function(){a.data.selectActividad=localStorage.getItem("selectActividad"),a.CambiarActividad()},a.guardarInfo=function(){if(a.data.errornombre="",a.data.errorcel="",a.data.erroremail="",""==a.data.nombre)return a.data.errornombre="Ingresa tu nombre y apellido",!1;if(isNaN(a.data.celular)||!/^3[\d]{9}$/.test(a.data.celular))return a.data.errorcel="Ingresa un número con el formato correcto",!1;if(""==a.data.email)return a.data.erroremail="Ingresa tu correo electrónico",!1;if(!/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(a.data.email))return a.data.erroremail="Ingresar una dirección de correo electrónico con el formato correcto",!1;a.writeFirebase()&&(a.data.ShowModal=!0)},a.writeFirebase=function(){var o=localStorage.getItem("simulacion"),t=JSON.parse(o),e=!1;try{var r={DatosPersonales:{nombre:a.data.nombre,celular:a.data.celular,email:a.data.email},Simulacion:t};e=firebase.database().ref("libranza").push(r)}catch(a){console.log(a)}return localStorage.removeItem("simulacion"),e},a.contactenos=function(){if(localStorage.setItem("selectActividad",a.data.selectActividad),""!=a.data.ingresos&&""!=a.data.descuentoNomina){montoAprox=a.data.montoAprox.replace(/\,/g,""),cuotaAprox=a.data.cuotaAprox.replace(/\,/g,""),ingresos=a.data.ingresos.replace(/\,/g,""),descuentoNomina=a.data.descuentoNomina.replace(/\,/g,"");var t={esMonto:a.data.ShowMonto,esCuota:a.data.ShowCuota,Actividad:a.data.selectActividad,convenio:a.data.selectConvenio,ingresos:ingresos,descuentoNomina:descuentoNomina,porcentajeDescuentoSalud:a.data.porcentajeDescuentos,descuentoSalud:a.data.descuentoSalud,montoFinanciar:""!=montoAprox?montoAprox:0,cuotaFinanciar:""!=cuotaAprox?cuotaAprox:0,plazo:a.data.plazo,tasa:a.data.cuotaMensual};localStorage.setItem("simulacion",JSON.stringify(t))}o.location.href="formContacto.html"},a.showindex=function(){o.location.href="index.html"}}]),app.directive("mileskeypress",(function(){return{restrict:"A",require:"ngModel",link:function(a,o,t,e){var r=function(a){if(void 0===a)return"";var o=(a=a.replace(/\,/g,"")).replace(/[^0-9,]/g,"");if(o!==a)e.$setViewValue(o),e.$render();else{if(o>999){for(var t=parseInt(o).toString().split(""),r=0,n=[],d=t.length-1,c=d;c>=0;c--){var s=t[c].replace(/\,/g,"");""!=s&&(d>=3?2==r&&0!=c?(n[c]=","+s,r=0):(n[c]=s,r+=1):n[c]=s)}o=n.join("")}e.$setViewValue(o),e.$render(),e.$setValidity("onlyNumbers",!0)}return o};e.$parsers.unshift(r),e.$parsers.push(r),t.$observe("onlyNumbers",(function(){r(e.$ViewValue)}))}}})).directive("letterkeypress",(function(){return{restrict:"A",require:"ngModel",link:function(a,o,t,e){var r=function(a){if(void 0===a)return"";var o=a.replace(/[^A-Za-z ]/g,"");return o!==a?(e.$setViewValue(o),e.$render()):e.$setValidity("onlyLetters",!0),o};e.$parsers.unshift(r),e.$parsers.push(r),t.$observe("onlyLetters",(function(){r(e.$ViewValue)}))}}})).directive("numberkeypress",(function(){return{restrict:"A",require:"ngModel",link:function(a,o,t,e){var r=function(a){if(void 0===a)return"";var o=a.replace(/[^0-9]/g,"");return o!==a?(e.$setViewValue(o),e.$render()):e.$setValidity("onlyNumbers",!0),o};e.$parsers.unshift(r),e.$parsers.push(r),t.$observe("onlyLetters",(function(){r(e.$ViewValue)}))}}}));