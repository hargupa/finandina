"use strict";var app=angular.module("Libranza",[]);app.controller("LibranzaController",["$scope","$window","$filter",function(r,o,a){firebase.initializeApp({apiKey:"AIzaSyC8vrdhMCthhxAw7CwEfN3OnVWPbHNFVpk",authDomain:"simuladores-75631.firebaseapp.com.firebaseapp.com",databaseURL:"https://simuladores-75631.firebaseio.com",storageBucket:"simuladores-75631.appspot.com.appspot.com"}),r.data={tasa:1.2,SMMLV:877803,minMontoPerimitido:3e6,minCuotaPerimitido:3e6,maxMontoPerimitido:1e8,maxCuotaPerimitido:1e8,capacidadDescuentoMonto:53400,capacidadDescuentoCuota:18e4,descuentoNomina:"",ingresos:"",selectActividad:"0",selectConvenio:"0",montoAprox:"",cuotaAprox:"",AproxCalculada:"",descuentoSalud:"",maxCuota:"",plazo:"",porcentajeDescuentos:"",errorDescNomina:"",errorIngresos:"",errorActividad:"",errorMonto:"",errorCuota:"",errorplazo:"",errorexcede:"",ShowMonto108Meses:!0,ShowMonto108MesesCuota:!1,ShowMonto96Meses:!0,ShowMonto96MesesCuota:!1,ShowMonto84Meses:!0,ShowMonto84MesesCuota:!1,ShowMonto72Meses:!0,ShowMonto72MesesCuota:!1,ShowMonto60Meses:!0,ShowMonto60MesesCuota:!1,ShowTextoPorcentaje:!1,ShowImgDefault:!0,ShowImgSectorPublico:!1,ShowImgDocente:!1,ShowImgFuerzas:!1,ShowImgPensionado:!1,ShowCuota:!1,ShowMonto:!0,ShowForm:!0,ShowAviso:!1,ShowModal:!1,nombre:"",celular:"",email:""},r.Cambiar=function(){1==r.data.ShowCuota?(r.data.ShowCuota=!1,r.data.ShowMonto=!0):(r.data.ShowCuota=!0,r.data.ShowMonto=!1),r.data.montoAprox="",r.data.cuotaAprox="",r.data.AproxCalculada=""},r.CambiarActividad=function(){switch(r.data.ShowImgDefault=!1,r.data.ShowImgSectorPublico=!1,r.data.ShowImgDocente=!1,r.data.ShowImgFuerzas=!1,r.data.ShowImgPensionado=!1,r.data.selectActividad){case"0":r.data.ShowImgDefault=!0;break;case"1":r.data.ShowImgSectorPublico=!0;break;case"2":r.data.ShowImgDocente=!0;break;case"3":r.data.ShowImgFuerzas=!0;break;case"4":r.data.ShowImgPensionado=!0}r.calcularDatos()},r.MostrarCuota=function(a){switch(r.data.ShowMonto108Meses=!0,r.data.ShowMonto108MesesCuota=!1,r.data.ShowMonto96Meses=!0,r.data.ShowMonto96MesesCuota=!1,r.data.ShowMonto84Meses=!0,r.data.ShowMonto84MesesCuota=!1,r.data.ShowMonto72Meses=!0,r.data.ShowMonto72MesesCuota=!1,r.data.ShowMonto60Meses=!0,r.data.ShowMonto60MesesCuota=!1,a){case 1:r.data.plazo=108,r.data.ShowMonto108Meses=!1,r.data.ShowMonto108MesesCuota=!0;break;case 2:r.data.plazo=96,r.data.ShowMonto96Meses=!1,r.data.ShowMonto96MesesCuota=!0;break;case 3:r.data.plazo=84,r.data.ShowMonto84Meses=!1,r.data.ShowMonto84MesesCuota=!0;break;case 4:r.data.plazo=72,r.data.ShowMonto72Meses=!1,r.data.ShowMonto72MesesCuota=!0;break;case 5:r.data.plazo=60,r.data.ShowMonto60Meses=!1,r.data.ShowMonto60MesesCuota=!0}r.calcularDatos()},r.mostrarTerminos=function(){r.data.ShowForm=!1,r.data.ShowTerminos=!0},r.ocultarTerminos=function(){r.data.ShowForm=!0,r.data.ShowTerminos=!1},r.validaciones=function(){if(r.data.errorActividad="",r.data.errorIngresos="",r.data.errorDescNomina="",r.data.errorMonto="",r.data.errorCuota="",r.data.errorplazo="",r.data.errorexcede="",r.data.AproxCalculada="","0"==r.data.selectActividad)return!(r.data.errorActividad="Debe indicar su actividad");if(""==r.data.ingresos)return!(r.data.errorIngresos="Debe indicar sus ingresos");if(!r.data.ShowImgPensionado&&(_ingresos=r.data.ingresos.replace(/\,/g,""),_ingresos<r.data.SMMLV))return!(r.data.errorIngresos="Ingreso mínimo 1 SMMLV");if(""==r.data.descuentoNomina)return r.data.ShowImgPensionado?r.data.errorDescNomina="Debe indicar sus descuentos":r.data.errorDescNomina="Debe indicar sus descuentos por nómina",!1;if(r.data.ShowMonto){if(""==r.data.montoAprox)return!(r.data.errorMonto="Debe indicar la cantidad de dinero que necesita");if(_montoAprox=r.data.montoAprox.replace(/\,/g,""),_montoAprox<r.data.minMontoPerimitido)return r.data.errorMonto="El monto del dinero no puede ser inferior a $"+a("currency")(r.data.minMontoPerimitido,"$",0),!1;if(_montoAprox>r.data.maxMontoPerimitido)return r.data.errorMonto="El monto del dinero no puede ser superior a $"+a("currency")(r.data.maxMontoPerimitido,"$",0),!1}return r.data.ShowCuota&&""==r.data.cuotaAprox?!(r.data.errorCuota="Debe indicar la cantidad de cuota que quiere pagar"):""!=r.data.plazo||!(r.data.errorplazo="Debe indicar el plazo en el que quiere pagar")},r.calcularDatos=function(){if(!r.validaciones())return!1;if(""==r.data.porcentajeDescuentos&&(r.data.ShowImgPensionado?r.data.porcentajeDescuentos=.12:r.data.porcentajeDescuentos=.08),_ingresos=r.data.ingresos.replace(/\,/g,""),_descuentoNomina=r.data.descuentoNomina.replace(/\,/g,""),r.data.descuentoSalud=_ingresos*r.data.porcentajeDescuentos,r.data.maxCuota=(_ingresos-r.data.descuentoSalud)/2-_descuentoNomina,r.data.ShowMonto){if(r.data.maxCuota<r.data.capacidadDescuentoMonto)return void(r.data.errorexcede="La cuota mensual excede tu capacidad de descuento");_montoAprox=r.data.montoAprox.replace(/\,/g,"");var a=r.calculoCuotaAprox(r.data.tasa,r.data.plazo,_montoAprox);if(a>r.data.maxCuota)return void(r.data.errorexcede="La cuota mensual excede tu capacidad de descuento");r.data.AproxCalculada=a}else if(r.data.ShowCuota){if(r.data.maxCuota<r.data.capacidadDescuentoCuota)return void(r.data.errorexcede="El monto excede tu capacidad de pago");_cuotaAprox=r.data.cuotaAprox.replace(/\,/g,"");a=r.calculoMontoAprox(r.data.tasa,r.data.plazo,_cuotaAprox);r.data.AproxCalculada=r.calculoRedondearMenos(a,5)}},r.calculoCuotaAprox=function(a,o,e){a/=100,o=Math.pow(1+a,o),o=a*o*e/(o-1);return isNaN(o)&&(o=0),Math.round(o)},r.calculoMontoAprox=function(a,o,e){a/=100,o=Math.pow(1+a,o),o=e*((o-1)/(a*o)),o=Math.round(o),o=Math.min(o,1e8);return isNaN(o)&&(result=0),o},r.calculoRedondearMenos=function(a,o){var e=a.toString(),a=e.length;if(o<a){for(var a=a-o,t=e.slice(0,a),r=0;r<o;r++)t=t.concat("0");return parseInt(t)}return 0},r.obtenerDatos=function(){r.data.selectActividad=localStorage.getItem("selectActividad"),r.CambiarActividad()},r.guardarInfo=function(){return r.data.errornombre="",r.data.errorcel="",(r.data.erroremail="")==r.data.nombre?!(r.data.errornombre="Debe ingresar su nombre y apellido"):""==r.data.celular?!(r.data.errorcel="Debe ingresar su numero de celular"):""==r.data.email?!(r.data.erroremail="Debe ingresar su correo electronico"):void(r.writeFirebase()&&(r.data.ShowModal=!0))},r.writeFirebase=function(){var a=localStorage.getItem("simulacion"),o=JSON.parse(a),e=!1;try{var t={DatosPersonales:{nombre:r.data.nombre,celular:r.data.celular,email:r.data.email},Simulacion:o},e=firebase.database().ref("libranza").push(t)}catch(a){console.log(a)}return localStorage.removeItem("simulacion"),e},r.contactenos=function(){var a;localStorage.setItem("selectActividad",r.data.selectActividad),""!=r.data.ingresos&&""!=r.data.descuentoNomina&&(montoAprox=r.data.montoAprox.replace(/\,/g,""),cuotaAprox=r.data.cuotaAprox.replace(/\,/g,""),ingresos=r.data.ingresos.replace(/\,/g,""),descuentoNomina=r.data.descuentoNomina.replace(/\,/g,""),a={esMonto:r.data.ShowMonto,esCuota:r.data.ShowCuota,Actividad:r.data.selectActividad,convenio:r.data.selectConvenio,ingresos:ingresos,descuentoNomina:descuentoNomina,porcentajeDescuentoSalud:r.data.porcentajeDescuentos,descuentoSalud:r.data.descuentoSalud,montoFinanciar:""!=montoAprox?montoAprox:0,cuotaFinanciar:""!=cuotaAprox?cuotaAprox:0,plazo:r.data.plazo,tasa:r.data.cuotaMensual},localStorage.setItem("simulacion",JSON.stringify(a))),o.location.href="formContacto.html"},r.showindex=function(){o.location.href="index.html"}}]),app.directive("mileskeypress",function(){return{restrict:"A",require:"ngModel",link:function(a,o,e,i){function t(a){if(void 0===a)return"";var o=(a=a.replace(/\,/g,"")).replace(/[^0-9,]/g,"");if(o!==a)i.$setViewValue(o),i.$render();else{if(999<o){for(var e=parseInt(o).toString().split(""),t=0,r=[],n=e.length-1,d=n;0<=d;d--){var s=e[d].replace(/\,/g,"");""!=s&&(3<=n?2==t&&0!=d?(r[d]=","+s,t=0):(r[d]=s,t+=1):r[d]=s)}o=r.join("")}i.$setViewValue(o),i.$render(),i.$setValidity("onlyNumbers",!0)}return o}i.$parsers.unshift(t),i.$parsers.push(t),e.$observe("onlyNumbers",function(){t(i.$ViewValue)})}}}).directive("letterkeypress",function(){return{restrict:"A",require:"ngModel",link:function(a,o,e,t){function r(a){if(void 0===a)return"";var o=a.replace(/[^A-Za-z ]/g,"");return o!==a?(t.$setViewValue(o),t.$render()):t.$setValidity("onlyLetters",!0),o}t.$parsers.unshift(r),t.$parsers.push(r),e.$observe("onlyLetters",function(){r(t.$ViewValue)})}}}).directive("numberkeypress",function(){return{restrict:"A",require:"ngModel",link:function(a,o,e,t){function r(a){if(void 0===a)return"";var o=a.replace(/[^0-9]/g,"");return o!==a?(t.$setViewValue(o),t.$render()):t.$setValidity("onlyNumbers",!0),o}t.$parsers.unshift(r),t.$parsers.push(r),e.$observe("onlyLetters",function(){r(t.$ViewValue)})}}});