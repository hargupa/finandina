var app=angular.module("simuladorCDT",[]);app.controller("CdtController",["$scope",function(a){a.Math=window.Math,a.data={montoInversion:"",tasaEA:4.7437,tasaEA_texto:"4.74% EA",plazoDias:"",fuente:4,ica:0,modalidad:"V",montoInteresNeto:0,totalInversion:0,errormonto:"",errordias:"",mindias:90,maxdias:540,minMontoInversion:1e6},a.calculos=function(){if(a.data.errormonto="",a.data.errordias="",a.data.montoInteresNeto=0,a.data.totalInversion=0,""==a.data.montoInversion)return a.data.errormonto="Debe ingresar el monto de la inversión",!1;if(""==a.data.plazoDias||null==a.data.plazoDias)return a.data.errordias="Debe ingresar el plazo en días",!1;if(_montoInversion=a.data.montoInversion.replace(/\,/g,""),_montoInversion<a.data.minMontoInversion)return a.data.errormonto="El monto mínimo para la inversión es de $"+a.data.minMontoInversion,!1;if(a.data.plazoDias<a.data.mindias)return a.data.errordias="El mínimo de días es "+a.data.mindias+" días.",!1;if(a.data.plazoDias>a.data.maxdias)return a.data.errordias="El máximo de días es "+a.data.maxdias+" días.",!1;var t;t=a.cdtNormal(_montoInversion),a.data.montoInteresNeto=Math.round(t),a.data.totalInversion=parseInt(_montoInversion)+parseInt(a.data.montoInteresNeto);var e=new Date;e.setDate(e.getDate()+parseInt(a.data.plazoDias)),a.data.fechaFinal=e.getDate()+"/"+e.getMonth()+"/"+e.getFullYear()},a.cdtNormal=function(t){var e=t*(a.data.tasaEA/100)/(360/a.data.plazoDias);return e-(e*(a.data.fuente/100)+e*(a.data.ica/100))},a.cdtDesmaterializado=function(){a.data.tasaEA;var t=Math.round(a.data.tasaEA/360*a.data.plazoDias).toFixed(6),e=Math.round(t*a.data.montoInversion),n=e-(Math.round(e*(a.data.fuente/100))+Math.round(e*(a.data.ica/100)));return a.data.montoInteresNeto=n,n}}]),app.directive("mileskeypress",(function(){return{restrict:"A",require:"ngModel",link:function(a,t,e,n){var o=function(a){if(void 0===a)return"";var t=(a=a.replace(/\,/g,"")).replace(/[^0-9,]/g,"");if(t!==a)n.$setViewValue(t),n.$render();else{if(t>999){for(var e=parseInt(t).toString().split(""),o=0,r=[],i=e.length-1,s=i;s>=0;s--){var d=e[s].replace(/\,/g,"");""!=d&&(i>=3?2==o&&0!=s?(r[s]=","+d,o=0):(r[s]=d,o+=1):r[s]=d)}t=r.join("")}n.$setViewValue(t),n.$render(),n.$setValidity("onlyNumbers",!0)}return t};n.$parsers.unshift(o),n.$parsers.push(o),e.$observe("onlyNumbers",(function(){o(n.$ViewValue)}))}}}));