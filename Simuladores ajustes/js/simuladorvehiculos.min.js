var app=angular.module("SimuladorVehiculos",[]);app.controller("SimuladorController",["$scope","$window",function(a,o){firebase.initializeApp({apiKey:"AIzaSyC8vrdhMCthhxAw7CwEfN3OnVWPbHNFVpk",authDomain:"simuladores-75631.firebaseapp.com.firebaseapp.com",databaseURL:"https://simuladores-75631.firebaseio.com",storageBucket:"simuladores-75631.appspot.com.appspot.com"}),a.Math=window.Math,a.data={tasa:1.22,minMonto:3e6,maxAnioCarro:14,maxAnioMoto:4,montoFinanciar:"",cuotaMensual:"",precioVehiculo:"",cuotaInicial:"",plazo:"",anioModelo:"",marcaVehiculo:"",errorPrecio:"",errorCuota:"",errorMonto:"",ShowMonto72Meses:!0,ShowMonto72MesesCuota:!1,ShowMonto60Meses:!0,ShowMonto60MesesCuota:!1,ShowMonto48Meses:!0,ShowMonto48MesesCuota:!1,ShowMonto36Meses:!0,ShowMonto36MesesCuota:!1,ShowMonto24Meses:!0,ShowMonto24MesesCuota:!1,ShowMonto12Meses:!0,ShowMonto12MesesCuota:!1,ShowImgCarro:!0,ShowImgMoto:!1,ShowTextoPorcentaje:!1,ShowForm:!0,ShowTerminos:!1,ShowTextoUsado:!1,ShowTextoNuevo:!0,ShowErrorValor:!1,ShowModeloCarroMoto:!0,ShowModeloCarroUsado:!1,ShowModal:!1,nombre:"",celular:"",email:""},a.MostrarCuota=function(o){switch(a.data.ShowMonto72Meses=!0,a.data.ShowMonto72MesesCuota=!1,a.data.ShowMonto60Meses=!0,a.data.ShowMonto60MesesCuota=!1,a.data.ShowMonto48Meses=!0,a.data.ShowMonto48MesesCuota=!1,a.data.ShowMonto36Meses=!0,a.data.ShowMonto36MesesCuota=!1,a.data.ShowMonto24Meses=!0,a.data.ShowMonto24MesesCuota=!1,a.data.ShowMonto12Meses=!0,a.data.ShowMonto12MesesCuota=!1,o){case 1:a.data.ShowMonto72Meses=!1,a.data.ShowMonto72MesesCuota=!0,a.data.plazo=72;break;case 2:a.data.ShowMonto60Meses=!1,a.data.ShowMonto60MesesCuota=!0,a.data.plazo=60;break;case 3:a.data.ShowMonto48Meses=!1,a.data.ShowMonto48MesesCuota=!0,a.data.plazo=48;break;case 4:a.data.ShowMonto36Meses=!1,a.data.ShowMonto36MesesCuota=!0,a.data.plazo=36;break;case 5:a.data.ShowMonto24Meses=!1,a.data.ShowMonto24MesesCuota=!0,a.data.plazo=24;break;case 6:a.data.ShowMonto12Meses=!1,a.data.ShowMonto12MesesCuota=!0,a.data.plazo=12}a.calcularDatos(),0==a.data.ShowImgCarro&&(a.data.ShowMonto72Meses=!1,a.data.ShowMonto72MesesCuota=!1)},a.CambiarVehiculo=function(){1==a.data.ShowImgCarro?(a.data.ShowImgCarro=!1,a.data.ShowImgMoto=!0,a.data.ShowMonto72Meses=!1,a.data.ShowMonto72MesesCuota=!1,a.data.ShowModeloCarroMoto=!0,a.data.ShowModeloCarroUsado=!1):(a.data.ShowImgCarro=!0,a.data.ShowImgMoto=!1,a.data.ShowMonto72Meses=!0,a.data.ShowMonto72MesesCuota=!1),a.data.anioModelo="",a.data.marcaVehiculo="",a.calcularDatos()},a.CambiarEstadoVehiculo=function(){1==a.data.ShowTextoNuevo?(a.data.ShowTextoUsado=!0,a.data.ShowTextoNuevo=!1,a.data.ShowModeloCarroMoto=!1,a.data.ShowModeloCarroUsado=!0):(a.data.ShowTextoUsado=!1,a.data.ShowTextoNuevo=!0,a.data.ShowModeloCarroMoto=!0,a.data.ShowModeloCarroUsado=!1),a.data.anioModelo="",a.calcularDatos()},a.calcularDatos=function(){if(a.data.errorPrecio="",a.data.errorCuota="",a.data.errorMonto="",a.data.errorModelo="",""==a.data.anioModelo)return a.data.errorModelo="ingrese el año del modelo del vehÍculo",a.data.montoFinanciar="",a.data.cuotaMensual="",!1;if(""==a.data.precioVehiculo)return a.data.errorPrecio="ingrese precio del vehÍculo",!1;_precioVehiculo=a.data.precioVehiculo.replace(/\,/g,""),_cuotaInicial=parseInt(a.data.cuotaInicial.replace(/\,/g,"")),isNaN(_cuotaInicial)&&(_cuotaInicial=0);var o=(new Date).getFullYear()-a.data.anioModelo;return a.data.ShowImgCarro&&o>a.data.maxAnioCarro||a.data.ShowImgMoto&&o>a.data.maxAnioMoto?(a.data.errorModelo="El modelo del vehÍculo no es factible",a.data.montoFinanciar="",a.data.cuotaMensual="",!1):(_montoFinanciar=_precioVehiculo-_cuotaInicial,a.data.montoFinanciar=_montoFinanciar>=0?_montoFinanciar:0,a.data.montoFinanciar<a.data.minMonto&&(a.data.errorMonto="El monto mÍnimo a financiar debe ser mayor que $"+a.data.minMonto),void(""!=a.data.plazo&&(a.data.cuotaMensual=a.calculoCuotaMensual(a.data.tasa,a.data.plazo,a.data.montoFinanciar))))},a.calculoPorcentajeFinanciacion=function(){var o=20;return a.data.ShowImgMoto&&(a.data.ShowTextoNuevo&&a.data.plazo>=12&&a.data.plazo<=60||a.data.ShowTextoUsado&&a.data.plazo>=12&&a.data.plazo<=48)&&(o=100),a.data.ShowImgCarro&&(a.data.ShowTextoNuevo&&a.data.plazo>=12&&a.data.plazo<=60?o=100:a.data.ShowTextoUsado&&a.data.plazo>=12&&a.data.plazo<=60&&(o=30)),o},a.calculoCuotaMensual=function(a,o,e){var t=(1+(a/=100))**o,r=a*t*e/(t-1);return Math.round(r)},a.guardarInfo=function(){return a.data.errornombre="",a.data.errorcel="",a.data.erroremail="",""==a.data.nombre?(a.data.errornombre="Debe ingresar su nombre y apellido",!1):""==a.data.celular?(a.data.errorcel="Debe ingresar su numero de celular",!1):""==a.data.email?(a.data.erroremail="Debe ingresar su correo electronico",!1):void(a.writeFirebase()&&(a.data.ShowModal=!0))},a.writeFirebase=function(){var o=localStorage.getItem("simulacion"),e=JSON.parse(o),t=!1;try{var r={DatosPersonales:{nombre:a.data.nombre,celular:a.data.celular,email:a.data.email},Simulacion:e};t=firebase.database().ref("vehiculo").push(r)}catch(a){console.log(a)}return localStorage.removeItem("simulacion"),t},a.contactenos=function(){if(""!=a.data.anioModelo&&""!=a.data.precioVehiculo&&""!=a.data.cuotaInicial){_cuotaInicial=parseInt(a.data.cuotaInicial.replace(/\,/g,"")),_precioVehiculo=parseInt(a.data.precioVehiculo.replace(/\,/g,""));var e={tipoVehiculo:a.data.ShowImgCarro?"Carro":"Moto",estadoVehiculo:a.data.ShowTextoNuevo?"Nuevo":"Usado",marcaVehiculo:a.data.marcaVehiculo,anioModelo:a.data.anioModelo,periodoPago:"Meses",tasa:a.data.tasa,precioVehiculo:_precioVehiculo,cuotaInicial:_cuotaInicial,montoFinanciar:a.data.montoFinanciar,cuotaMensual:a.data.cuotaMensual,plazo:a.data.plazo};localStorage.setItem("simulacion",JSON.stringify(e))}o.location.href="formContacto.html"},a.showindex=function(){o.location.href="index.html"}}]),app.directive("mileskeypress",(function(){return{restrict:"A",require:"ngModel",link:function(a,o,e,t){var r=function(a){if(void 0===a)return"";var o=(a=a.replace(/\,/g,"")).replace(/[^0-9,]/g,"");if(o!==a)t.$setViewValue(o),t.$render();else{if(o>999){for(var e=parseInt(o).toString().split(""),r=0,n=[],i=e.length-1,s=i;s>=0;s--){var d=e[s].replace(/\,/g,"");""!=d&&(i>=3?2==r&&0!=s?(n[s]=","+d,r=0):(n[s]=d,r+=1):n[s]=d)}o=n.join("")}t.$setViewValue(o),t.$render(),t.$setValidity("onlyNumbers",!0)}return o};t.$parsers.unshift(r),t.$parsers.push(r),e.$observe("onlyNumbers",(function(){r(t.$ViewValue)}))}}})).directive("letterkeypress",(function(){return{restrict:"A",require:"ngModel",link:function(a,o,e,t){var r=function(a){if(void 0===a)return"";var o=a.replace(/[^A-Za-z ]/g,"");return o!==a?(t.$setViewValue(o),t.$render()):t.$setValidity("onlyLetters",!0),o};t.$parsers.unshift(r),t.$parsers.push(r),e.$observe("onlyLetters",(function(){r(t.$ViewValue)}))}}})).directive("numberkeypress",(function(){return{restrict:"A",require:"ngModel",link:function(a,o,e,t){var r=function(a){if(void 0===a)return"";var o=a.replace(/[^0-9]/g,"");return o!==a?(t.$setViewValue(o),t.$render()):t.$setValidity("onlyNumbers",!0),o};t.$parsers.unshift(r),t.$parsers.push(r),e.$observe("onlyLetters",(function(){r(t.$ViewValue)}))}}}));